var Web3 = require('web3');
var web3 = new Web3();

web3.setProvider(new web3.providers.HttpProvider('http://localhost:8545'));

var c4_ABI = [{"constant":false,"inputs":[],"name":"initGame","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"player2","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"filled","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"lastMoveCol","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":false,"inputs":[{"name":"col","type":"uint8"}],"name":"move","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"p2","type":"address"}],"name":"setPlayer2","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"name":"board","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"turn","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"lastMoveRow","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":false,"inputs":[{"name":"player","type":"address"}],"name":"getPlayerNumber","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"player1","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"winner","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"end","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"p1","type":"address"}],"name":"setPlayer1","outputs":[{"name":"","type":"bool"}],"type":"function"},{"inputs":[],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"c4","type":"address"},{"indexed":false,"name":"player","type":"string"},{"indexed":false,"name":"col","type":"uint8"},{"indexed":false,"name":"row","type":"uint8"}],"name":"PlayerMoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"c4","type":"address"},{"indexed":true,"name":"nextPlayer","type":"address"},{"indexed":false,"name":"player","type":"string"}],"name":"newTurn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"c4","type":"address"},{"indexed":true,"name":"winner","type":"address"},{"indexed":false,"name":"player","type":"string"}],"name":"GameEnd","type":"event"}];
var c4_data = '60606040525b33600b60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b6125cd8061003f6000396000f3606060405236156100d7576000357c01000000000000000000000000000000000000000000000000000000009004806332eb2564146100d957806341c0e1b5146100fc57806359a5f12d1461010b5780636f1a859a146101445780636fbc7c481461017357806370e87aaf1461019957806373da64a0146101c55780638086a92a146101f15780638b29990314610229578063a03fbe8c14610262578063ada4a40114610288578063d30895e4146102b7578063dfbf53ae146102f0578063efbe1c1c14610316578063f88ac72414610339576100d7565b005b6100e660048050506105c7565b6040518082815260200191505060405180910390f35b6101096004805050611833565b005b61011860048050506103f9565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61015a60048080359060200190919050506103a5565b604051808260ff16815260200191505060405180910390f35b610180600480505061046b565b604051808260ff16815260200191505060405180910390f35b6101af6004808035906020019091905050610af1565b6040518082815260200191505060405180910390f35b6101db600480803590602001909190505061052c565b6040518082815260200191505060405180910390f35b6102106004808035906020019091908035906020019091905050610365565b604051808260ff16815260200191505060405180910390f35b610236600480505061041f565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61026f600480505061047e565b604051808260ff16815260200191505060405180910390f35b61029e6004808035906020019091905050610a23565b604051808260ff16815260200191505060405180910390f35b6102c460048050506103d3565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102fd6004805050610458565b604051808260ff16815260200191505060405180910390f35b6103236004805050610445565b6040518082815260200191505060405180910390f35b61034f6004808035906020019091905050610491565b6040518082815260200191505060405180910390f35b60006000508260078110156100025790900160005b50816006811015610002579090602091828204019190065b915091509054906101000a900460ff1681565b6007600050816007811015610002579090602091828204019190065b9150909054906101000a900460ff1681565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600a60149054906101000a900460ff1681565b600a60159054906101000a900460ff1681565b600a60169054906101000a900460ff1681565b600a60179054906101000a900460ff1681565b6000600b60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156104f35760009050610527565b81600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555060019050610527565b919050565b6000600b60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561058e57600090506105c2565b81600960006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600190506105c2565b919050565b6000600060006000600b60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561062f5760009350610a1d565b6000600a60146101000a81548160ff021916908302179055506000600a60156101000a81548160ff0219169083021790555060ff600a60166101000a81548160ff0219169083021790555060ff600a60176101000a81548160ff02191690830217905550600092505b60068360ff1611151561074f57600091505b60058260ff1611151561070d57600060006000508460ff1660078110156100025790900160005b508360ff166006811015610002579090602091828204019190065b6101000a81548160ff021916908302179055505b81806001019250506106aa565b600060076000508460ff166007811015610002579090602091828204019190065b6101000a81548160ff021916908302179055505b8280600101935050610698565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141580156107d157506000600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614155b15610a14576002426001430340600190040260ff1606905060008160ff16141561090257600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600a60006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572310000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a3610a0b565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600a60006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572320000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b60019350610a1d565b60009350610a1d565b50505090565b6000600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610a845760019050610aec565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610ae35760029050610aec565b60009050610aec565b919050565b6000600060006000600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610b59576000935061182b565b6001600a60149054906101000a900460ff161415610b7a576000935061182b565b60068560ff161115610d8357600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610cbe57600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572310000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a3610d7a565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572320000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b6000935061182b565b60076000508560ff166007811015610002579090602091828204019190065b9054906101000a900460ff16925060068360ff16101515610fba57600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610ef557600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572310000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a3610fb1565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572320000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b6000935061182b565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561116457600160006000508660ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b6101000a81548160ff021916908302179055503073ffffffffffffffffffffffffffffffffffffffff167fa8bd85da5d7f3d59990fa98e58ffed6e9aa6e58cc8655d7bd0ac8e62c83cd7cb868560405180806020018460ff1681526020018360ff168152602001828103825260078152602001807f506c617965723100000000000000000000000000000000000000000000000000815260200150602001935050505060405180910390a2600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600a60006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550611292565b600260006000508660ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b6101000a81548160ff021916908302179055503073ffffffffffffffffffffffffffffffffffffffff167fa8bd85da5d7f3d59990fa98e58ffed6e9aa6e58cc8655d7bd0ac8e62c83cd7cb868560405180806020018460ff1681526020018360ff168152602001828103825260078152602001807f506c617965723200000000000000000000000000000000000000000000000000815260200150602001935050505060405180910390a2600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600a60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b84600a60166101000a81548160ff0219169083021790555082600a60176101000a81548160ff021916908302179055506001830160076000508660ff166007811015610002579090602091828204019190065b6101000a81548160ff0219169083021790555061130285846118c7565b600a60156101000a81548160ff021916908302179055506000600a60159054906101000a900460ff1660ff16141515611505576001600a60146101000a81548160ff021916908302179055506001600a60159054906101000a900460ff1660ff16141561142557600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f67e639336cb038d01b3aaf639d75a7d3c315d7936a3ea6ec6c86cbd2afbd6ed16040518080602001828103825260078152602001807f506c61796572310000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b6002600a60159054906101000a900460ff1660ff1614156114fc57600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f67e639336cb038d01b3aaf639d75a7d3c315d7936a3ea6ec6c86cbd2afbd6ed16040518080602001828103825260078152602001807f506c61796572320000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b6001935061182b565b60019150600090505b60078160ff16101561156957600660076000508260ff166007811015610002579090602091828204019190065b9054906101000a900460ff1660ff16101561155b57600091508150611569565b5b808060010191505061150e565b811561162e576001600a60146101000a81548160ff0219169083021790555060003073ffffffffffffffffffffffffffffffffffffffff167f67e639336cb038d01b3aaf639d75a7d3c315d7936a3ea6ec6c86cbd2afbd6ed16040518080602001828103825260038152602001807f546965000000000000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a36000600a60156101000a81548160ff021916908302179055506001935061182b565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600a60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561176657600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572310000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a3611822565b600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167f9d4832f1fb3be975fbddc6ed8fb989b20d9794c14281eb6bb095fdd3d03d68436040518080602001828103825260078152602001807f506c61796572320000000000000000000000000000000000000000000000000081526020015060200191505060405180910390a35b6001935061182b565b505050919050565b600b60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156118c457600b60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b565b6000600060068460ff1611806118e0575060058360ff16115b156118ee5760009150611960565b6118f88484611967565b9050805060008160ff1614151561191157809150611960565b61191b8484611c5a565b9050805060008160ff1614151561193457809150611960565b61193e8484611f4d565b9050805060008160ff1614151561195757809150611960565b60009150611960565b5092915050565b60006000600090505b60038160ff16111515611c4a578360ff168160ff16111561199057611c3d565b600660038286030160ff1611156119a657611c3d565b6001600060005082860360ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16148015611a3f57506001600060005060018387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611a9157506001600060005060028387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611ae357506001600060005060038387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b15611af15760019150611c53565b6002600060005082860360ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16148015611b8a57506002600060005060018387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611bdc57506002600060005060028387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611c2e57506002600060005060038387030160ff1660078110156100025790900160005b508460ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b15611c3c5760029150611c53565b5b8080600101915050611970565b60009150611c53565b5092915050565b60006000600090505b60038160ff16111515611f3d578260ff168160ff161115611c8357611f30565b600560038285030160ff161115611c9957611f30565b600160006000508560ff1660078110156100025790900160005b5082850360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16148015611d325750600160006000508560ff1660078110156100025790900160005b5060018386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611d845750600160006000508560ff1660078110156100025790900160005b5060028386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611dd65750600160006000508560ff1660078110156100025790900160005b5060038386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b15611de45760019150611f46565b600260006000508560ff1660078110156100025790900160005b5082850360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16148015611e7d5750600260006000508560ff1660078110156100025790900160005b5060018386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611ecf5750600260006000508560ff1660078110156100025790900160005b5060028386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b8015611f215750600260006000508560ff1660078110156100025790900160005b5060038386030160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b15611f2f5760029150611f46565b5b8080600101915050611c63565b60009150611f46565b5092915050565b60006000600083600503905060038160ff161115611f6c576003905080505b6000915081505b8060ff168260ff16111515612294578160ff168560ff161015611f9557612287565b600382850160ff161015611fa857612287565b600382860360ff161115611fbb57612287565b600582850160ff161115611fce57612287565b6001600060005083870360ff1660078110156100025790900160005b5083860160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff1614801561206e57506001600060005060018488030160ff1660078110156100025790900160005b5060018487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b80156120c557506001600060005060028488030160ff1660078110156100025790900160005b5060028487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b801561211c57506001600060005060038488030160ff1660078110156100025790900160005b5060038487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b1561212a57600192506125c5565b6002600060005083870360ff1660078110156100025790900160005b5083860160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff161480156121ca57506002600060005060018488030160ff1660078110156100025790900160005b5060018487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b801561222157506002600060005060028488030160ff1660078110156100025790900160005b5060028487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b801561227857506002600060005060038488030160ff1660078110156100025790900160005b5060038487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b1561228657600292506125c5565b5b8180600101925050611f73565b6000915081505b8060ff168260ff161115156125bc57600682860160ff1611156122bd576125af565b600682850160ff1611156122d0576125af565b600382860160ff1610156122e3576125af565b600382850160ff1610156122f6576125af565b6001600060005083870160ff1660078110156100025790900160005b5083860160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff1614801561239657506001600060005060018488010360ff1660078110156100025790900160005b5060018487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b80156123ed57506001600060005060028488010360ff1660078110156100025790900160005b5060028487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b801561244457506001600060005060038488010360ff1660078110156100025790900160005b5060038487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b1561245257600192506125c5565b6002600060005083870160ff1660078110156100025790900160005b5083860160ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff161480156124f257506002600060005060018488010360ff1660078110156100025790900160005b5060018487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b801561254957506002600060005060028488010360ff1660078110156100025790900160005b5060028487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b80156125a057506002600060005060038488010360ff1660078110156100025790900160005b5060038487010360ff166006811015610002579090602091828204019190065b9054906101000a900460ff1660ff16145b156125ae57600292506125c5565b5b818060010192505061229b565b600092506125c5565b50509291505056';
var p_ABI = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"c4","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[],"name":"move","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"col","type":"uint8"}],"name":"manualMove","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"_c4","type":"address"}],"name":"setConnect4","outputs":[{"name":"","type":"bool"}],"type":"function"},{"inputs":[{"name":"_name","type":"string"},{"name":"_c4","type":"address"}],"type":"constructor"}];
var p_data = '6060604052604051610729380380610729833981016040528080518201919060200180519060200190919050505b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055508160016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a757805160ff19168380011785556100d8565b828001600101855582156100d8579182015b828111156100d75782518260005055916020019190600101906100b9565b5b50905061010391906100e5565b808211156100ff57600081815060009055506001016100e5565b5090565b505060008173ffffffffffffffffffffffffffffffffffffffff161415156101515780600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b5b50506105c7806101626000396000f360606040523615610074576000357c01000000000000000000000000000000000000000000000000000000009004806306fdde03146100765780632aa111f6146100f15780633ec48a2e1461012a57806341c0e1b51461014d5780637c8d59bf1461015c578063dd7866581461018857610074565b005b6100836004805050610465565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156100e35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100fe6004805050610506565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61013760048050506101b4565b6040518082815260200191505060405180910390f35b61015a60048050506103d1565b005b61017260048080359060200190919050506102cb565b6040518082815260200191505060405180910390f35b61019e600480803590602001909190505061052c565b6040518082815260200191505060405180910390f35b60006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561021857600091506102c7565b60074260014303406001900402069050600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370e87aaf82604051827c0100000000000000000000000000000000000000000000000000000000028152600401808260ff1681526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015091506102c7565b5090565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561032d57600090506103cc565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370e87aaf83604051827c0100000000000000000000000000000000000000000000000000000000028152600401808260ff1681526020019150506020604051808303816000876161da5a03f115610002575050506040518051906020015090506103cc565b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561046257600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b565b60016000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104fe5780601f106104d3576101008083540402835291602001916104fe565b820191906000526020600020905b8154815290600101906020018083116104e157829003601f168201915b505050505081565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561058e57600090506105c2565b81600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550600190506105c2565b91905056';

var p1Transactions = [];
var p2Transactions = [];

/* Deploy c4 board */
var connect4Contract = web3.eth.contract(c4_ABI);
var connect4 = connect4Contract.new(
   {
     from: web3.eth.accounts[0], 
     data: c4_data, 
     gas: 9999999
   }, function(e, c4){

    if (typeof c4.address != 'undefined') {
         console.log('[C4 contract mined] Address: ' + c4.address);

         /* Create player1 */
         var _p1_name = "Player1";
         var _c4 = c4.address;
         var playerContract = web3.eth.contract(p_ABI);
         var player = playerContract.new(
         	_p1_name,
         	_c4,
         	{
         		from: web3.eth.accounts[0], 
         		data: p_data, 
         		gas: 999999999
         	}, function(e, p1){
         		if (typeof p1.address != 'undefined') {
         			console.log('[Player1 contract mined] Address: ' + p1.address);

         			/* Create player2 */
         			var _p2_name = "Player2";
         			var _c4 = c4.address;
         			var playerContract = web3.eth.contract(p_ABI);
         			var player = playerContract.new(
         				_p2_name,
         				_c4,
         				{
         					from: web3.eth.accounts[0], 
         					data: p_data, 
         					gas: 999999999
         				}, function(e, p2){
         					if (typeof p2.address != 'undefined') {
         						console.log('[Player2 contract mined] Address: ' + p2.address);

							    /* Set player1 */							    
							    c4.setPlayer1(p1.address, {from:web3.eth.accounts[0], gas:99999999}, function(error,result) {
							    	if(!error) {

							    		console.log("[Player1 set]");

							    		/* Set player2 */
							    		c4.setPlayer2(p2.address, {from:web3.eth.accounts[0], gas:99999999}, function(error,result) {
							    			if(!error) {
							    				console.log("[Player2 set]");
							    				//console.log(result);
							    				
							    				/* Init game */
							    				c4.initGame({from:web3.eth.accounts[0], gas:99999999}, function(error,result) {

							    					if (!error) {
							    						console.log("[Game begin]");

							    						/* Create filters */
							    						var filterPlayerMoved = c4.PlayerMoved();
							    						var filterNewTurn = c4.newTurn();
							    						var filterGameEnd = c4.GameEnd();   							    

							    						filterPlayerMoved.watch(function (error, result) {
							    							if(!error) {
							    								if(result.args.c4 == c4.address) {
								    								if (result.args.player == "Player1") {
								    									console.log("[Player moved] "+_p1_name+" moved ("+result.args.col+","+result.args.row+").");
								    								} else {
								    									console.log("[Player moved] "+_p2_name+" moved ("+result.args.col+","+result.args.row+").");
								    								}
								    							}
							    							} else {
							    								console.log("[Player moved] "+error);
							    							}
							    						});

							    						filterNewTurn.watch(function (error, result) {
							    							if(!error) {
							    								if(result.args.c4 == c4.address) {
							    									if(result.args.player == "Player1") {
							    										console.log("[New turn] It is now "+_p1_name+"'s turn.");
							    										var t = p1.move({from:web3.eth.accounts[0], gas:999999999});
																		console.log("(DEBUG) Player1 sent move transacion: "+t);
																		p1Transactions.push(t);
							    									} else {
							    										console.log("[New turn] It is now "+_p2_name+"'s turn.");
							    										var t = p2.move({from:web3.eth.accounts[0], gas:999999999});
																		console.log("(DEBUG) Player2 sent move transacion: "+t);
							    										p2Transactions.push(t);
							    									}
							    								}
							    							} else {
							    								console.log("[New turn] "+error);
							    							}
							    						});

							    						filterGameEnd.watch(function (error, result) {	
							    							if(!error) {
							    								if(result.args.c4 == c4.address) {
							    									if(result.args.player == "Player1") {
								    									console.log("[Game end] "+_p1_name+" won.");
								    								} else if (result.args.player == "Player2") {
																		console.log("[Game end] "+_p2_name+" won.");
								    								} else {
																		console.log("[Game end] Tie.");
																	}
							    								}
							    							} else {
							    								console.log("[Game end] "+error);
							    							}

							    							totalGasP1=0;
							    							for (i=0; i<p1Transactions.length; i++) {
							    								receipt = web3.eth.getTransactionReceipt(p1Transactions[i]);
							    								totalGasP1+=receipt.gasUsed;
							    							}

							    							totalGasP2=0;
							    							for (i=0; i<p2Transactions.length; i++) {
							    								receipt = web3.eth.getTransactionReceipt(p2Transactions[i]);
							    								totalGasP2+=receipt.gasUsed;
							    							}							    							

							    							console.log("Total gas used by Player1: "+totalGasP1);
							    							console.log("Total gas used by Player2: "+totalGasP2);
							    							process.exit();
							    						});							    						

							    					}

							    				})
							    			}
							    		})
							    	}
							    })							    

         					}
         				})

         		}
         })

    }
 })